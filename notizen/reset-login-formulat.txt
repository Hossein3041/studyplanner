Ich habe das Folgende Problem:

1. Was GENAU ist das Problem?

Ist-Zustand (Beobachtung):

Du startest die App, gehst auf die Login-View.

Du loggst dich mit g√ºltigen Daten ein:

Das Login-Formular (#login-form) wird ausgeblendet.

Die Erfolgsmeldung (#login-success-message) wird angezeigt:

‚úì Willkommen zur√ºck!
Du wirst zum Dashboard weitergeleitet...

Du wirst auf das Dashboard weitergeleitet ‚Üí alles korrekt.

Du klickst auf ‚ÄûLogout‚Äú:

Die Session wird serverseitig beendet.

Die SPA navigiert (oder l√§dt neu) zur Route login.

Die Login-View wird wieder angezeigt, aber:

Das Formular ist sichtbar ‚úÖ

Die Erfolgsmeldung ‚ÄûWillkommen zur√ºck! Du wirst zum Dashboard weitergeleitet‚Ä¶‚Äú ist immer noch sichtbar ‚ùå

Soll-Zustand:

Nach dem Logout, wenn die Login-View angezeigt wird:

Nur das Login-Formular soll sichtbar sein.

Die Erfolgsmeldung darf NICHT sichtbar sein (soll so aussehen wie beim allerersten Aufruf der Seite).

Kurz:
Die Erfolgsmeldung der letzten erfolgreichen Anmeldung wird beim Logout / erneuten √ñffnen der Login-View nicht zuverl√§ssig zur√ºckgesetzt und bleibt deshalb sichtbar.

In welchen Dateien liegt das Problem?


index.html

<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <title>StudyPlanner</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Variante B: relativ (empfohlen) -->
    <link rel="stylesheet" href="/meine-webapp/static/style.css" />
  </head>
  <body>
    <header class="header">
      <div class="logo">
        üéì <span>StudyPlanner 01</span>
      </div>
      <nav class="nav">
  <a class="nav-link" href="#" data-route="home" id="nav-home">Home</a>
  <a class="nav-link" href="#" data-route="dashboard" id="nav-dashboard">
    Dashboard
  </a>
  <a class="nav-link" href="#" data-route="modules" id="nav-modules">
    Module
  </a>
  <a class="nav-link" href="#" data-route="tasks" id="nav-tasks">
    Aufgaben
  </a>
  <a class="nav-link" href="#" data-route="sessions" id="nav-sessions">
    Lernsessions
  </a>
  <a class="nav-link" href="#" data-route="login" id="nav-login">
    Login
  </a>
  <a class="nav-link" href="#" data-route="register" id="nav-register">
    Registrieren
  </a>
  <a
    class="nav-link logout"
    href="#"
    data-route="logout"
    id="nav-logout"
    style="display: none"
  >
    Logout
  </a>
  <button
  id="darkmode-toggle"
  class="darkmode-toggle"
  aria-label="Designmodus umschalten"
>
  <span class="toggle-icon sun">‚òÄÔ∏è</span>
  <span class="toggle-thumb"></span>
  <span class="toggle-icon moon">üåô</span>
</button>


</nav>


    </header>

    <!-- Home / Landing -->
    <section id="home" class="view active">
      <div class="hero">
        <h1>Willkommen beim StudyPlanner</h1>
        <p>
          Plane deine Module, Aufgaben und Lernsessions an einem Ort
          ‚Äì einfache √úbersicht f√ºr dein Studium.
        </p>
        <div class="hero-actions">
          <div class="hero-actions">
  <a href="#" class="btn primary" data-route="register">Jetzt starten</a>
  <a href="#" class="btn secondary" data-route="login">Login</a>
</div>

        </div>
      </div>
    </section>

        <!-- Login -->
    <section id="login" class="view">
      <div class="login-container">
        <div class="login-card">
          <div class="login-header">
            <h2>Login</h2>
            <p>Melde dich mit deinen Zugangsdaten an</p>
          </div>

          <form class="login-form" id="login-form" novalidate>
            <!-- E-Mail -->
            <div class="form-group">
              <div class="input-wrapper">
                <input
                  type="email"
                  id="login-email"
                  name="email"
                  required
                  autocomplete="email"
                />
                <label for="login-email">E-Mail-Adresse</label>
              </div>
              <span class="error-message" id="login-email-error"></span>
            </div>

            <!-- Passwort -->
            <div class="form-group">
              <div class="input-wrapper password-wrapper">
                <input
                  type="password"
                  id="login-password"
                  name="password"
                  required
                  autocomplete="current-password"
                />
                <label for="login-password">Passwort</label>
                <button
                  type="button"
                  class="password-toggle"
                  id="login-password-toggle"
                  aria-label="Passwort ein-/ausblenden"
                >
                  <span class="eye-icon"></span>
                </button>
              </div>
              <span class="error-message" id="login-password-error"></span>
            </div>

            <!-- optional: Remember me -->
            <div class="form-options">
              <label class="remember-wrapper">
                <input type="checkbox" id="login-remember" name="remember" />
                <span class="checkbox-label">
                  <span class="checkmark"></span>
                  Eingeloggt bleiben
                </span>
              </label>
              <!-- optional: Passwort vergessen -->
              <a href="#" class="forgot-password">Passwort vergessen?</a>
            </div>

            <button type="submit" class="login-btn">
              <span class="btn-text">Einloggen</span>
              <span class="btn-loader"></span>
            </button>
          </form>

          <div class="signup-link">
            <p>
              Noch kein Konto?
              <a href="#" data-route="register">Konto erstellen</a>
            </p>
          </div>

          <div class="success-message" id="login-success-message" hidden>
            <div class="success-icon">‚úì</div>
            <h3>Willkommen zur√ºck!!</h3>
            <p>Du wirst zum Dashboard weitergeleitet...</p>
          </div>
        </div>
      </div>
    </section>


        <!-- Registrierung -->
    <section id="register" class="view">
      <div class="login-container">
        <div class="login-card">
          <div class="login-header">
            <h2>Registrierung</h2>
            <p>Erstelle ein neues Konto f√ºr deinen StudyPlanner</p>
          </div>

          <form id="register-form" class="login-form" novalidate>
            <!-- E-Mail -->
            <div class="form-group">
              <div class="input-wrapper">
                <input
                  type="email"
                  id="reg-email"
                  name="email"
                  required
                  autocomplete="email"
                />
                <label for="reg-email">E-Mail-Adresse</label>
              </div>
              <span class="error-message" id="reg-email-error"></span>
            </div>

            <!-- Passwort -->
            <div class="form-group">
              <div class="input-wrapper password-wrapper">
                <input
                  type="password"
                  id="reg-password"
                  name="password"
                  required
                  autocomplete="new-password"
                />
                <label for="reg-password">Passwort</label>
                <button
                  type="button"
                  class="password-toggle"
                  id="reg-password-toggle"
                  aria-label="Passwort ein-/ausblenden"
                >
                  <span class="eye-icon"></span>
                </button>
              </div>
              <span class="error-message" id="reg-password-error"></span>
            </div>

            <!-- Passwort best√§tigen -->
            <div class="form-group">
              <div class="input-wrapper password-wrapper">
                <input
                  type="password"
                  id="reg-password-confirm"
                  name="password-confirm"
                  required
                  autocomplete="new-password"
                />
                <label for="reg-password-confirm">Passwort best√§tigen</label>
                <button
                  type="button"
                  class="password-toggle"
                  id="reg-password-confirm-toggle"
                  aria-label="Passwort ein-/ausblenden"
                >
                  <span class="eye-icon"></span>
                </button>
              </div>
              <span class="error-message" id="reg-password-confirm-error"></span>
            </div>

            <button type="submit" class="login-btn">
              <span class="btn-text">Registrieren</span>
              <span class="btn-loader"></span>
            </button>
          </form>

          <div class="signup-link">
            <p>
              Schon ein Konto?
              <a href="#" data-route="login">Zum Login</a>
            </p>
          </div>

          <div class="success-message" id="register-success-message">
            <div class="success-icon">‚úì</div>
            <h3>Registrierung erfolgreich!</h3>
            <p>Du kannst dich jetzt einloggen.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Dashboard -->
    <section id="dashboard" class="view">
      <h2>Dashboard</h2>
      <div id="dashboard-stats" class="dashboard-grid">
        <div class="card">
          <h3>Offene Aufgaben</h3>
          <p id="stat-open-tasks">‚Äì</p>
        </div>
        <div class="card">
          <h3>N√§chste Pr√ºfung</h3>
          <p id="stat-next-exam">‚Äì</p>
        </div>
        <div class="card">
          <h3>Lernzeit (diese Woche)</h3>
          <p id="stat-study-time">‚Äì</p>
        </div>
      </div>
    </section>

    <!-- Module -->
    <section id="modules" class="view">
      <h2>Module</h2>
      <form id="module-form" class="form inline-form">
        <input
          type="text"
          id="module-name"
          placeholder="Modulname (z.B. Datenbanken 2)"
          required
        />
        <input
          type="text"
          id="module-semester"
          placeholder="Semester (z.B. 3)"
        />
        <button type="submit" class="btn primary">Modul hinzuf√ºgen</button>
      </form>

      <div id="module-list" class="list-container">
        <!-- wird per JS gef√ºllt -->
      </div>
    </section>

    <!-- Aufgaben -->
    <section id="tasks" class="view">
      <h2>Aufgaben</h2>
      <form id="task-form" class="form">
        <label for="task-title">Titel</label>
        <input type="text" id="task-title" required />

        <label for="task-module">Modul</label>
        <select id="task-module"></select>

        <label for="task-deadline">Deadline</label>
        <input type="date" id="task-deadline" />

        <label for="task-priority">Priorit√§t</label>
        <select id="task-priority">
          <option value="LOW">Niedrig</option>
          <option value="MEDIUM" selected>Mittel</option>
          <option value="HIGH">Hoch</option>
        </select>

        <button type="submit" class="btn primary">Aufgabe anlegen</button>
      </form>

      <div id="task-list" class="list-container">
        <!-- wird per JS gef√ºllt -->
      </div>
    </section>

    <!-- Lernsessions -->
    <section id="sessions" class="view">
      <h2>Lernsessions</h2>
      <form id="session-form" class="form">
        <label for="session-module">Modul</label>
        <select id="session-module"></select>

        <label for="session-date">Datum</label>
        <input type="date" id="session-date" />

        <label for="session-duration">Dauer (Minuten)</label>
        <input type="number" id="session-duration" min="5" step="5" />

        <label for="session-note">Notiz</label>
        <textarea id="session-note" rows="2"></textarea>

        <button type="submit" class="btn primary">Session speichern</button>
      </form>

      <div id="session-list" class="list-container">
        <!-- wird per JS gef√ºllt -->
      </div>
    </section>

    <section id="admin" class="view">
      <!-- Admin-Inhalt wird von adminView.js hineingerendert -->
    </section> 

     <!-- Impressum -->
    <section id="impressum" class="view">
      <h2>Impressum</h2>
      <p>Dies ist ein Beispiel-Impressum ‚Ä¶</p>
    </section>

    <!-- Datenschutz -->
    <section id="datenschutz" class="view">
      <h2>Datenschutz</h2>
      <p>Dies ist eine Beispiel-Datenschutzrichtlinie ‚Ä¶</p>
    </section>

   <footer class="footer">
  <div class="footer-inner">
    <!-- Spalte 1: √úber die App -->
    <div class="footer-section">
      <h4>StudyPlanner</h4>
      <ul>
        <li>Plane Module, Aufgaben und Lernsessions an einem Ort.</li>
        <li>Kleinprojekt im Rahmen deines Studiums.</li>
      </ul>
    </div>

    <!-- Spalte 2: Rechtliches -->
    <div class="footer-section">
      <h4>Rechtliches</h4>
      <ul>
        <li><a href="#" data-route="impressum">Impressum</a></li>
        <li><a href="#" data-route="datenschutz">Datenschutz</a></li>
      </ul>
    </div>

    <!-- Spalte 3: Kontakt & Designmodus -->
    <div class="footer-section">
      <h4>Kontakt & Status</h4>
      <ul>
        <li>Theme: <span id="current-theme-label">Light</span></li>
        <li>Version: <span id="app-version">‚Äì</span></li>
        <li>Build: <span id="build-timestamp">‚Äì</span></li>
      </ul>
    </div>
  </div>

  <div class="footer-bottom">
    &copy; 2025 StudyPlanner ‚Äì gebaut von Hossein üôÇ
  </div>
</footer>

    <script type="module" src="/meine-webapp/static/main.js"></script>
  </body>
</html>


style.css

/* src/main/webapp/static/style.css */

/* Header / Navigation */
@import url("./header.css");

/* ===== Globales Layout & Theme-Variablen ===== */

:root {
  --bg: #f8fafc;
  --text: #0f172a;
  --muted-text: #64748b;

  --card-bg: #ffffff;
  --card-border: #e2e8f0;

  --header-bg: linear-gradient(135deg, #0059b3 0%, #007bff 100%);
  --header-text: #ffffff;

  --footer-bg: #e0f2fe;

  --primary: #6366f1;
  --primary-dark: #4f46e5;

  --link: #0369a1;
  --link-hover: #0ea5e9;

  --input-bg: #ffffff;
  --input-border: #e2e8f0;
  --input-text: #1e293b;

  --overlay-bg: rgba(15, 23, 42, 0.65);
}

.dark {
  --bg: #020617;
  --text: #e2e8f0;
  --muted-text: #94a3b8;

  --card-bg: #0f172a;
  --card-border: #1f2937;

  --header-bg: linear-gradient(135deg, #020617 0%, #0b1120 100%);
  --header-text: #e2e8f0;

  --footer-bg: #020617;

  --primary: #818cf8;
  --primary-dark: #6366f1;

  --link: #38bdf8;
  --link-hover: #7dd3fc;

  --input-bg: #020617;
  --input-border: #374151;
  --input-text: #e2e8f0;

  --overlay-bg: rgba(0, 0, 0, 0.6);
}

*,
*::before,
*::after {
  box-sizing: border-box;
}

html,
body {
  margin: 0;
  padding: 0;
  background: var(--bg);
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica,
    Arial, sans-serif;
  line-height: 1.6;
  color: var(--text);
  transition: background 0.25s ease, color 0.25s ease;
}

/* SPA-Views: nur .active ist sichtbar */
.view {
  display: none;
}

.view.active {
  display: block;
}


/* ===== Auth / Login & Register Form (Basic Login Form) ===== */

.login-container {
  max-width: 450px;
  margin: 40px auto;
}

.login-card {
  background: var(--card-bg);
  border-radius: 12px;
  padding: 32px;
  border: 1px solid var(--card-border);
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
  transition: background 0.25s ease, border-color 0.25s ease,
    box-shadow 0.25s ease;
}

.login-header {
  text-align: center;
  margin-bottom: 32px;
}

.login-header h2 {
  font-size: 1.875rem;
  font-weight: 700;
  color: var(--text);
  margin-bottom: 8px;
}

.login-header p {
  color: var(--muted-text);
  font-size: 0.875rem;
}

/* Form Styles */
.form-group {
  margin-bottom: 20px;
}

.input-wrapper {
  position: relative;
  display: flex;
  flex-direction: column;
}

.input-wrapper input {
  background: var(--input-bg);
  border: 2px solid var(--input-border);
  border-radius: 8px;
  padding: 12px 16px 8px 16px;
  color: var(--input-text);
  font-size: 16px;
  transition: all 0.2s ease;
  width: 100%;
  outline: none;
}

.input-wrapper input::placeholder {
  color: transparent;
}

.input-wrapper label {
  position: absolute;
  left: 16px;
  top: 12px;
  color: var(--muted-text);
  font-size: 16px;
  transition: all 0.2s ease;
  pointer-events: none;
  transform-origin: left top;
}

/* Floating Label wenn Input fokussiert ist oder Inhalt hat */
.input-wrapper input:focus + label,
.input-wrapper input.has-value + label {
  top: -6px;
  left: 12px;
  background: var(--bg);
  padding: 0 4px;
  font-size: 0.75rem;
  font-weight: 500;
  color: var(--primary);
  transform: translateY(-8px) scale(0.875);
}


/* Password Toggle */
.password-wrapper {
  position: relative;
}

.password-wrapper input {
  padding-right: 48px;
}

.password-toggle {
  position: absolute;
  right: 12px;
  top: 50%;
  transform: translateY(-50%);
  background: none;
  border: none;
  cursor: pointer;
  padding: 8px;
  color: #64748b;
  transition: color 0.2s ease;
}

.password-toggle:hover {
  color: #1e293b;
}

.eye-icon {
  display: block;
  width: 20px;
  height: 20px;
  background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%2364748b' stroke-width='1.5'%3e%3cpath stroke-linecap='round' stroke-linejoin='round' d='M15 12a3 3 0 11-6 0 3 3 0 016 0z'/%3e%3cpath stroke-linecap='round' stroke-linejoin='round' d='M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z'/%3e%3c/svg%3e");
  background-size: contain;
  background-repeat: no-repeat;
  background-position: center;
  transition: background-image 0.2s ease;
}

.eye-icon.show-password {
  background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%2364748b' stroke-width='1.5'%3e%3cpath stroke-linecap='round' stroke-linejoin='round' d='M3.98 8.223A10.477 10.477 0 001.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.45 10.45 0 0112 4.5c4.756 0 8.773 3.162 10.065 7.498a10.523 10.523 0 01-4.293 5.774M6.228 6.228L3 3m3.228 3.228l3.65 3.65m7.894 7.894L21 21m-3.228-3.228l-3.65-3.65m0 0a3 3 0 11-4.243-4.243m4.242 4.242L9.88 9.88'/%3e%3c/svg%3e");
}

/* Error Messages */
.error-message {
  display: block;
  color: #ef4444;
  font-size: 0.75rem;
  font-weight: 500;
  margin-top: 4px;
  margin-left: 4px;
  opacity: 0;
  transform: translateY(-4px);
  transition: all 0.2s ease;
}

.error-message.show {
  opacity: 1;
  transform: translateY(0);
}

.form-group.error .input-wrapper input {
  border-color: #ef4444;
}

/* Form Options */
.form-options {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 24px;
  flex-wrap: wrap;
  gap: 12px;
}

.remember-wrapper {
  display: flex;
  align-items: center;
  gap: 8px;
  cursor: pointer;
}

.remember-wrapper input[type="checkbox"] {
  display: none;
}

.checkbox-label {
  color: #64748b;
  font-size: 0.875rem;
  cursor: pointer;
  user-select: none;
  display: flex;
  align-items: center;
  gap: 8px;
}

.checkmark {
  width: 16px;
  height: 16px;
  border: 2px solid #d1d5db;
  border-radius: 4px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
  flex-shrink: 0;
  background: white;
}

.remember-wrapper input[type="checkbox"]:checked ~ .checkbox-label .checkmark {
  background: #6366f1;
  border-color: #6366f1;
}

.remember-wrapper input[type="checkbox"]:checked ~ .checkbox-label .checkmark::after {
  content: "‚úì";
  color: white;
  font-size: 10px;
  font-weight: bold;
}

.forgot-password {
  color: #6366f1;
  text-decoration: none;
  font-size: 0.875rem;
  font-weight: 500;
  transition: color 0.2s ease;
}

.forgot-password:hover {
  color: #4f46e5;
}

/* Button */
.login-btn {
  width: 100%;
  background: var(--primary);
  border: none;
  border-radius: 8px;
  padding: 12px 24px;
  color: white;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease;
  position: relative;
  margin-bottom: 24px;
}

.login-btn:hover {
  background: var(--primary-dark);
}

.login-btn:active {
  transform: translateY(1px);
}

/* Loading State */
.login-btn.loading {
  pointer-events: none;
  background: #a5a6f6;
}

.btn-text {
  transition: opacity 0.2s ease;
}

.btn-loader {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 16px;
  height: 16px;
  border: 2px solid transparent;
  border-top: 2px solid white;
  border-radius: 50%;
  opacity: 0;
  animation: spin 1s linear infinite;
  transition: opacity 0.2s ease;
}

.login-btn.loading .btn-text {
  opacity: 0;
}

.login-btn.loading .btn-loader {
  opacity: 1;
}

/* Signup Link */
.signup-link {
  text-align: center;
}

.signup-link p {
  color: #64748b;
  font-size: 0.875rem;
}

.signup-link a {
  color: #6366f1;
  text-decoration: none;
  font-weight: 500;
  transition: color 0.2s ease;
}

.signup-link a:hover {
  color: #4f46e5;
}

/* Success Message */
.success-message[hidden] {
  display: none !important;
}

.success-message {
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
  padding: 32px 20px;
  opacity: 0;
  transform: translateY(20px);
  transition: all 0.3s ease;
}

.success-message.show {
  display: block;
  opacity: 1;
  transform: translateY(0);
}

.success-icon {
  width: 48px;
  height: 48px;
  background: #22c55e;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  color: white;
  margin: 0 auto 16px;
  animation: successPulse 0.5s ease;
}

.success-message h3 {
  color: #1e293b;
  font-size: 1.25rem;
  margin-bottom: 8px;
}

.success-message p {
  color: #64748b;
  font-size: 0.875rem;
}

/* Animations */
@keyframes spin {
  0% {
    transform: translate(-50%, -50%) rotate(0deg);
  }
  100% {
    transform: translate(-50%, -50%) rotate(360deg);
  }
}

@keyframes successPulse {
  0% {
    transform: scale(0);
  }
  50% {
    transform: scale(1.1);
  }
  100% {
    transform: scale(1);
  }
}

@media (max-width: 480px) {
  .login-card {
    padding: 24px;
    margin: 10px;
  }

  .login-header h2 {
    font-size: 1.5rem;
  }

  .form-options {
    flex-direction: column;
    align-items: flex-start;
    gap: 16px;
  }
}

/* ------------ Footer Styles ------------ */

/* ------------ Footer Styles ------------ */

.footer {
  background: var(--footer-bg);
  padding: 40px 20px 20px;
  color: var(--text);
  margin-top: 40px;
}

footer.footer {
  flex-shrink: 0;
}

.footer-inner {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 30px;
  max-width: 1100px;
  margin: 0 auto 20px;
}

.footer-section h4 {
  margin-bottom: 12px;
  font-size: 1.1rem;
  font-weight: 600;
}

.footer-section ul {
  list-style: none;
  padding: 0;
  margin: 0;
}

.footer-section li {
  margin-bottom: 8px;
}

.footer-section a {
  text-decoration: none;
  color: var(--link);
  font-size: 0.9rem;
}

.footer-section a:hover {
  text-decoration: underline;
  color: var(--link-hover);
}

.icon {
  width: 18px;
  height: 18px;
  vertical-align: middle;
  margin-right: 6px;
}

.version-info {
  margin-top: 14px;
  font-size: 0.8rem;
  color: var(--muted-text);
}

.footer-bottom {
  border-top: 1px solid rgba(148, 163, 184, 0.4);
  padding-top: 12px;
  text-align: center;
  font-size: 0.8rem;
  color: var(--muted-text);
}


loginView.js

// src/main/webapp/static/views/loginView.js
import { loginUser, fetchSession } from "../api.js";

export function initLoginView() {
  const form = document.getElementById("login-form");
  const successMessage = document.getElementById("login-success-message");

  if (!form) {
    console.warn("LoginView: #login-form nicht gefunden");
    return;
  }

  // ---------------------------------------------------
  // RESET DER LOGIN VIEW (bei JEDEM Aufruf)
  // ---------------------------------------------------
  form.style.display = "block"; // Formular sichtbar
  if (successMessage) {
    successMessage.hidden = true;       // Erfolgsmeldung sicher verstecken
    successMessage.classList.remove("show");
  }

  const emailInput = document.getElementById("login-email");
  const passwordInput = document.getElementById("login-password");
  const emailError = document.getElementById("login-email-error");
  const passwordError = document.getElementById("login-password-error");
  const passwordToggle = document.getElementById("login-password-toggle");

  // Eingabefelder zur√ºcksetzen
  if (emailInput) {
    emailInput.value = "";
    emailInput.classList.remove("has-value");
  }
  if (passwordInput) {
    passwordInput.value = "";
    passwordInput.classList.remove("has-value");
    passwordInput.type = "password"; // falls vorher sichtbar
  }

  // Fehler zur√ºcksetzen
  if (emailError) {
    emailError.textContent = "";
    emailError.classList.remove("show");
  }
  if (passwordError) {
    passwordError.textContent = "";
    passwordError.classList.remove("show");
  }

  const emailGroup = emailInput?.closest(".form-group");
  const passwordGroup = passwordInput?.closest(".form-group");
  emailGroup?.classList.remove("error");
  passwordGroup?.classList.remove("error");

  if (!emailInput || !passwordInput) {
    console.warn("LoginView: Eingabefelder nicht gefunden");
    return;
  }

  let isSubmitting = false;

  // ---------------------------------------------------
  // Floating Labels
  // ---------------------------------------------------
  [emailInput, passwordInput].forEach((input) => {
    const updateHasValue = () => {
      input.classList.toggle("has-value", input.value.trim() !== "");
    };
    input.addEventListener("input", updateHasValue);
    updateHasValue();
  });

  // ---------------------------------------------------
  // Passwort-Auge
  // ---------------------------------------------------
  if (passwordToggle) {
    const eye = passwordToggle.querySelector(".eye-icon");

    passwordToggle.onclick = () => {
      const showing = passwordInput.type === "text";
      passwordInput.type = showing ? "password" : "text";
      eye?.classList.toggle("show-password", !showing);
    };
  }

  // ---------------------------------------------------
  // Hilfsfunktionen Fehler
  // ---------------------------------------------------
  function showFieldError(input, errorElement, message) {
    const group = input.closest(".form-group");
    group?.classList.add("error");

    if (errorElement) {
      errorElement.textContent = message;
      errorElement.classList.add("show");
    }
  }

  function clearFieldError(input, errorElement) {
    const group = input.closest(".form-group");
    group?.classList.remove("error");

    if (errorElement) {
      errorElement.classList.remove("show");
      errorElement.textContent = "";
    }
  }

  // ---------------------------------------------------
  // Submit-Handler ‚Äì EIN Handler pro Init
  // ---------------------------------------------------
  form.onsubmit = async (e) => {
    e.preventDefault();
    if (isSubmitting) return;

    clearFieldError(emailInput, emailError);
    clearFieldError(passwordInput, passwordError);

    const email = emailInput.value.trim();
    const password = passwordInput.value.trim();

    let hasError = false;

    if (!email) {
      showFieldError(emailInput, emailError, "Bitte E-Mail eingeben.");
      hasError = true;
    }
    if (!password) {
      showFieldError(passwordInput, passwordError, "Bitte Passwort eingeben.");
      hasError = true;
    }

    if (hasError) return;

    isSubmitting = true;
    const submitBtn = form.querySelector(".login-btn");
    submitBtn?.classList.add("loading");

    try {
      // 1) Login durchf√ºhren
      await loginUser(email, password);

      // 2) Session abrufen
      const session = await fetchSession();

      // 3) Erfolgsmeldung anzeigen
      form.style.display = "none";
      if (successMessage) {
        successMessage.hidden = false;   // anzeigen
        successMessage.classList.add("show");
      }

      // 4) Weiterleiten
      setTimeout(() => {
        if (window.navigateTo) {
          if (session?.role === "ADMIN") {
            window.navigateTo("admin");
          } else {
            window.navigateTo("dashboard");
          }
        }
      }, 1200);
    } catch (err) {
      console.error("Login-Fehler:", err);
      showFieldError(
        passwordInput,
        passwordError,
        err?.message || "Login fehlgeschlagen."
      );
    } finally {
      isSubmitting = false;
      submitBtn?.classList.remove("loading");
    }
  };
}


main.js

// src/main/webapp/static/main.js

import { fetchSession, logoutUser } from "./api.js";

import { initHomeView } from "./views/homeView.js";
import { initLoginView } from "./views/loginView.js";
import { initRegisterView } from "./views/registerView.js";
import { initDashboardView } from "./views/dashboardView.js";
import { initModulesView } from "./views/modulesView.js";
import { initTasksView } from "./views/tasksView.js";
import { initSessionsView } from "./views/sessionsView.js";
import { initAdminView } from "./views/adminView.js";

const CONTEXTPATH = "/meine-webapp/";
const THEME_KEY = "theme";

/* ========================
   THEME / DARK MODE
   ======================== */

/** Lies gespeichertes Theme oder System-Preference */
function getPreferredTheme() {
  const stored = localStorage.getItem(THEME_KEY);
  if (stored === "light" || stored === "dark") {
    return stored;
  }

  // Hast du die Frage schon einmal bekommen?
  const confirmShown = localStorage.getItem("themeConfirmShown");

  // System-Einstellung auslesen
  let systemTheme = "light";
  if (window.matchMedia) {
    const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
    systemTheme = prefersDark ? "dark" : "light";
  }

  // Wenn Frage noch nie gezeigt wurde ‚Üí einmal nachfragen
  if (!confirmShown) {
    const msg =
      systemTheme === "dark"
        ? "Dein System ist im Dunkelmodus. Diesen Modus f√ºr StudyPlanner √ºbernehmen?"
        : "Dein System ist im Hellmodus. Diesen Modus f√ºr StudyPlanner √ºbernehmen?";

    const accept = window.confirm(msg);
    localStorage.setItem("themeConfirmShown", "yes");

    if (accept) {
      return systemTheme;
    }
  }

  // Standard: Light
  return "light";
}

function updateThemeLabel(theme) {
  const el = document.getElementById("current-theme-label");
  if (!el) return;
  el.textContent = theme === "dark" ? "Dark" : "Light";
}

/** wendet Theme auf <html> an und speichert es */
function applyTheme(theme) {
  const isDark = theme === "dark";
  document.documentElement.classList.toggle("dark", isDark);
  localStorage.setItem(THEME_KEY, theme);
  updateThemeLabel(theme);
}

/** Initialisiert den Toggle im Header */
function initThemeToggle() {
  const toggle = document.getElementById("darkmode-toggle");
  if (!toggle) return;

  // Beim Laden aktuellen Zustand visuell setzen
  const isDark = document.documentElement.classList.contains("dark");
  toggle.classList.toggle("is-dark", isDark);

  toggle.addEventListener("click", () => {
    const currentlyDark = document.documentElement.classList.contains("dark");
    const nextTheme = currentlyDark ? "light" : "dark";
    applyTheme(nextTheme);
    toggle.classList.toggle("is-dark", nextTheme === "dark");
  });
}

/* m√∂glichst fr√ºh Theme anwenden, um Flackern zu vermeiden */
applyTheme(getPreferredTheme());

/* ========================
   META-INFO (Version / Build)
   ======================== */

async function loadMetaInfo() {
  try {
    const resp = await fetch(`${CONTEXTPATH}static/meta.json`);
    if (!resp.ok) throw new Error("HTTP " + resp.status);
    const meta = await resp.json();

    const versionEl = document.getElementById("app-version");
    const buildEl = document.getElementById("build-timestamp");

    if (versionEl) versionEl.textContent = meta.version ?? "unknown";
    if (buildEl) buildEl.textContent = meta.build ?? "unknown";
  } catch (e) {
    console.warn("Konnte meta.json nicht laden:", e);
    const versionEl = document.getElementById("app-version");
    const buildEl = document.getElementById("build-timestamp");
    if (versionEl) versionEl.textContent = "unknown";
    if (buildEl) buildEl.textContent = "unknown";
  }
}

/* ========================
   ROUTING-UTILS
   ======================== */

/** Pfad aus der Browser-URL -> "Route" (home, login, dashboard, ...) */
function getRouteFromPath(pathname) {
  let path = pathname;
  if (path.startsWith(CONTEXTPATH)) {
    path = path.substring(CONTEXTPATH.length);
  }
  path = path.replace(/^\//, "");

  if (path === "" || path === "index.html") {
    return "home";
  }
  return path;
}

/** Route -> URL im Browser */
function getFullPath(route) {
  if (!route || route === "home") {
    return CONTEXTPATH;
  }
  return CONTEXTPATH + route.replace(/^\//, "");
}

/** API-Endpunkt -> echte URL (f√ºr ajaxJson in api.js) */
function getApiUrl(endpoint) {
  const [path, queryString] = endpoint.split("?");
  const normalized = path.startsWith("/") ? path.substring(1) : path;
  const baseUrl = CONTEXTPATH + "api/" + normalized;
  return queryString ? `${baseUrl}?${queryString}` : baseUrl;
}

// Globale Utilities, damit api.js sie benutzen kann
window.routingUtils = {
  CONTEXTPATH,
  getRouteFromPath,
  getFullPath,
  getApiUrl,
};

/* ========================
   VIEW-KONFIGURATION
   ======================== */

const publicViews = ["home", "login", "register", "impressum", "datenschutz"];
const protectedViews = ["dashboard", "modules", "tasks", "sessions", "admin"];

const viewInitializers = {
  home: initHomeView,
  login: initLoginView,
  register: initRegisterView,
  dashboard: initDashboardView,
  modules: initModulesView,
  tasks: initTasksView,
  sessions: initSessionsView,
  admin: initAdminView,
  impressum: () => {},
  datenschutz: () => {},
};

const initializedViews = new Set();

async function checkViewAuthorization(viewId) {
  const session = await fetchSession().catch(() => ({ loggedIn: false }));
  const loggedIn = !!session.loggedIn;

  if (publicViews.includes(viewId)) {
    return viewId;
  }

  if (protectedViews.includes(viewId)) {
    if (!loggedIn) {
      return "login";
    }
    return viewId;
  }

  // Unbekannte Route -> home
  return "home";
}

function showViewSync(viewId) {
  // Alle Views verstecken
  document.querySelectorAll(".view").forEach((v) => {
    v.classList.remove("active");
  });

  // Gew√ºnschte View anzeigen
  const active = document.getElementById(viewId);
  if (active) {
    active.classList.add("active");
  } else {
    console.warn("Unbekannte View:", viewId);
  }

  // View-spezifische Initialisierung
  const init = viewInitializers[viewId];

  if (viewId === "login") {
    // Login-View IMMER neu initialisieren (Reset von Formular & Messages)
    if (init) init();
  } else {
    // Alle anderen Views nur einmal initialisieren
    if (init && !initializedViews.has(viewId)) {
      init();
      initializedViews.add(viewId);
    }
  }

  // Navbar immer aktualisieren
  updateNavbar(viewId);
}

async function navigateTo(route) {
  const allowed = await checkViewAuthorization(route);
  const fullPath = getFullPath(allowed);
  history.pushState({ view: allowed }, "", fullPath);
  showViewSync(allowed);
}

window.navigateTo = navigateTo;

/* ========================
   NAVBAR / STATUS
   ======================== */

async function updateNavbar(currentView) {
  const session = await fetchSession().catch(() => ({ loggedIn: false }));
  const loggedIn = !!session.loggedIn;

  const loginLink = document.getElementById("nav-login");
  const registerLink = document.getElementById("nav-register");
  const logoutLink = document.getElementById("nav-logout");
  const dashboardLink = document.getElementById("nav-dashboard");
  const modulesLink = document.getElementById("nav-modules");
  const tasksLink = document.getElementById("nav-tasks");
  const sessionsLink = document.getElementById("nav-sessions");

  if (loggedIn) {
    if (loginLink) loginLink.style.display = "none";
    if (registerLink) registerLink.style.display = "none";
    if (logoutLink) logoutLink.style.display = "inline-block";

    if (dashboardLink) dashboardLink.style.display = "inline-block";
    if (modulesLink) modulesLink.style.display = "inline-block";
    if (tasksLink) tasksLink.style.display = "inline-block";
    if (sessionsLink) sessionsLink.style.display = "inline-block";

    const adminLink = document.getElementById("nav-admin");
    
    if (session.role === "ADMIN") {
      adminLink?.classList.remove("hidden");
      adminLink.style.display = "inline-block";
    } else {
      adminLink?.classList.add("hidden");
      adminLink.style.display = "none";
    }

  } else {
    if (loginLink) loginLink.style.display = "inline-block";
    if (registerLink) registerLink.style.display = "inline-block";
    if (logoutLink) logoutLink.style.display = "none";

    if (dashboardLink) dashboardLink.style.display = "none";
    if (modulesLink) modulesLink.style.display = "none";
    if (tasksLink) tasksLink.style.display = "none";
    if (sessionsLink) sessionsLink.style.display = "none";
  }

  // Aktiven Link markieren (√ºber data-route)
  document.querySelectorAll(".nav-link").forEach((link) => {
    link.classList.remove("active");
    const route = link.dataset.route;
    if (!route) return;

    if (route === currentView || (currentView === "home" && route === "home")) {
      link.classList.add("active");
    }
  });
}

/* ========================
   NAVIGATION-SETUP
   ======================== */

function setupNavigation() {
  // Header-Links + Hero-Buttons + ggf. Login/Signup-Links
  const clickable = document.querySelectorAll(
    ".nav-link, #home .hero-actions a, .signup-link a"
  );

  clickable.forEach((link) => {
    const route = link.dataset.route;
    if (!route) {
      // Link ohne data-route -> normales Verhalten
      return;
    }

    link.addEventListener("click", async (e) => {
      e.preventDefault();

      if (route === "logout") {
  try {
    await logoutUser();
  } catch (err) {
    console.error("Logout fehlgeschlagen:", err);
  }

  // Optional: schon mal Login-View "aufr√§umen", falls DOM noch sichtbar ist
  const loginForm = document.getElementById("login-form");
  const successMessage = document.getElementById("login-success-message");
  if (loginForm) {
    loginForm.style.display = "block";
  }
  if (successMessage) {
    successMessage.hidden = true;
    successMessage.classList.remove("show");
  }

  // WICHTIG: Hard-Reload der Login-Route
  window.location.href = getFullPath("login");
  return;
}


      navigateTo(route);
    });
  });

  // Back/Forward-Buttons im Browser
  window.addEventListener("popstate", async (e) => {
    const requested =
      e.state?.view || getRouteFromPath(window.location.pathname);
    const allowed = await checkViewAuthorization(requested);
    showViewSync(allowed);
  });
}

/* ========================
   INITIALISIERUNG
   ======================== */

document.addEventListener("DOMContentLoaded", async () => {
  initThemeToggle();
  loadMetaInfo();
  setupNavigation();

  const initialRoute = getRouteFromPath(window.location.pathname);
  await navigateTo(initialRoute);
});


